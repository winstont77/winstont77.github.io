<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"winstont77.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hanna &amp; Ruby &amp; Bru鼠 可愛動物區">
<meta property="og:url" content="http://winstont77.github.io/index.html">
<meta property="og:site_name" content="Hanna &amp; Ruby &amp; Bru鼠 可愛動物區">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Winston Hsu">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://winstont77.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Hanna & Ruby & Bru鼠 可愛動物區</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hanna & Ruby & Bru鼠 可愛動物區</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://winstont77.github.io/2024/05/13/feat-ooc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Winston Hsu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hanna & Ruby & Bru鼠 可愛動物區">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/05/13/feat-ooc/" class="post-title-link" itemprop="url">資料庫設計與併發問題 - 樂觀鎖</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-13 01:35:24" itemprop="dateCreated datePublished" datetime="2024-05-13T01:35:24+08:00">2024-05-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-05-14 00:51:09" itemprop="dateModified" datetime="2024-05-14T00:51:09+08:00">2024-05-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>前言:<br>上一篇講到庫存扣減的腳本的設計如果只使用預設的隔離層級，在高併發的情況下可能會造成超賣的現象。<br>這篇文章要講的就是，併發情況下使用樂觀鎖解決超賣的問題。</p>
<p>直接使用SQL來解釋樂觀鎖是甚麼</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dbo.Product(</span><br><span class="line">	ProductID <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,           <span class="comment">/* 商品Id */</span></span><br><span class="line">	Quantity <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,            <span class="comment">/* 庫存 */</span></span><br><span class="line">	Version <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,             <span class="comment">/* 版本(樂觀鎖) */</span></span><br><span class="line">	<span class="keyword">PRIMARY</span> KEY (</span><br><span class="line">		ProductID</span><br><span class="line">	)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dbo.Product <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">100</span>,<span class="number">1</span>);       <span class="comment">/* 資料庫初始化商品Id設為1，庫存為100，版本(樂觀鎖)為1 */</span></span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/cetOJTT.png" alt="Image"></p>
<p>接著會使用測試工具進行高併發情的模擬，我用的是SQLQueryStress。<br>並且在測試工具的參數中給定<br>Number of Iterations:50<br>Number of Threads:100<br>(和上一篇一樣的參數)<br>如下:<br><img src="https://i.imgur.com/w4MqPIi.png" alt="Image"></p>
<p>並且在測試工具中使用以下腳本</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span> TRAN</span><br><span class="line">    <span class="comment">/* 訂單選擇的商品、以及訂購的數量、版本(樂觀鎖)*/</span></span><br><span class="line">	<span class="keyword">DECLARE</span> <span class="variable">@ProductID</span> <span class="type">INT</span> <span class="operator">=</span> <span class="number">1</span>,</span><br><span class="line">			<span class="variable">@Quantity</span> <span class="type">INT</span> <span class="operator">=</span> <span class="number">1</span>,</span><br><span class="line">			<span class="variable">@Version</span> <span class="type">INT</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    <span class="comment">/* 判斷是否有此商品Id、足夠庫存以及正確的版本(樂觀鎖) */</span></span><br><span class="line">	IF <span class="keyword">EXISTS</span>(</span><br><span class="line">		<span class="keyword">SELECT</span> <span class="number">1</span></span><br><span class="line">		<span class="keyword">FROM</span> dbo.Product</span><br><span class="line">		<span class="keyword">WHERE</span> ProductID <span class="operator">=</span> <span class="variable">@ProductID</span></span><br><span class="line">			  <span class="keyword">AND</span> Quantity <span class="operator">&gt;=</span> <span class="variable">@Quantity</span> </span><br><span class="line">			  <span class="keyword">AND</span> Version <span class="operator">=</span> <span class="variable">@Version</span></span><br><span class="line">	)</span><br><span class="line">    <span class="comment">/* 有此商品、足夠庫存以及正確版本，則對資料庫內該商品的庫存進行扣減以及對版本(樂觀鎖)進行增加 */</span></span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line">		<span class="keyword">UPDATE</span> dbo.Product</span><br><span class="line">		<span class="keyword">SET</span> Quantity <span class="operator">=</span> Quantity <span class="operator">-</span> <span class="variable">@Quantity</span>,</span><br><span class="line">		    Version <span class="operator">=</span> Version <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">		<span class="keyword">WHERE</span> ProductID <span class="operator">=</span> <span class="variable">@ProductID</span> <span class="keyword">AND</span> Version <span class="operator">=</span> <span class="variable">@Version</span></span><br><span class="line">	<span class="keyword">END</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMIT</span> TRAN</span><br></pre></td></tr></table></figure>

<p>接著按下Go<br>跑完後去看資料庫內的庫存<br>執行該語法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br></pre></td></tr></table></figure>

<p><img src="https://i.imgur.com/7prNgD5.png" alt="Image"></p>
<p>耶~沒有發生超賣的情況了，但是好像哪裡怪怪的…為什麼只有賣出一件商品???</p>
<p>我們先看一下併發情況下的交易的流程和資料庫關係圖<br>1.一種是阿冠比較慢開始交易<br><img src="https://i.imgur.com/4Bb8mx3.png" alt="Image"></p>
<p>2.另一種情況是腦袋比阿冠慢開始交易，但是比阿冠早結束交易<br><img src="https://i.imgur.com/UvBc08A.png" alt="Image"></p>
<p>至於為什麼阿冠和腦袋可以一起查詢相同的資料，是因為SQL Server對交易有預設的鎖，雖然交易裡沒有對資料寫上任何的鎖，但其實預設為共享鎖(shared lock)。因此阿冠或是腦袋都對該筆資料有讀取的權力，如果是腦袋先開始進行交易裡對該筆資料的修改操作就會對該筆資料掛上獨佔鎖(exclusive lock)，這時就只有腦袋的交易有對該筆資料進行操作的權力，其餘交易則會被阻塞。而腦袋的交易將該筆資料的庫存扣1後再將版本加1，並將交易committed後釋放該筆資料的獨占鎖。阿冠的交易執行更新語法的時候，因為版本已經被腦袋的交易修改因此更新語法的WHERE比對版本有差異而導致阿冠的交易committed失敗。<br>如下圖:<br><img src="https://i.imgur.com/Ky1DsyZ.png" alt="Image"></p>
<p>腦袋比阿冠慢開始交易，但是比阿冠早結束交易，害阿冠的交易committed失敗也是同理。<br><img src="https://i.imgur.com/OJK0rDV.png" alt="Image"></p>
<p>simple tips:<br>共享鎖：<br>共享鎖通常在讀取操作中使用，允許多個讀取交易同時讀取同一數據，而不允許任何交易修改這些數據。當你的數據庫在 READ COMMITTED 隔離級別運行，且未啟用 READ_COMMITTED_SNAPSHOT 時，讀取操作會獲得共享鎖。這種鎖的主要目的是維護讀取一致性，並防止讀取到未提交的修改（即防止髒讀）。</p>
<p>獨佔鎖：<br>獨佔鎖在修改數據（如插入、更新或刪除操作）時使用。當交易對數據進行修改時，它會獲得獨佔鎖，以防止其他交易讀取或修改這些數據。獨佔鎖確保只有執行修改的交易可以訪問數據，直到交易完成，這有助於防止數據在提交前被其他交易看到或修改。</p>
<p>以及對於原文中提到的交易有預設鎖定可以參考官方文件的READ COMMITTED部分。<br><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/sql/t-sql/statements/set-transaction-isolation-level-transact-sql?view=sql-server-ver16">https://learn.microsoft.com/en-us/sql/t-sql/statements/set-transaction-isolation-level-transact-sql?view=sql-server-ver16</a></p>
<p>在高併發情境使用樂觀鎖的設計，不管腦袋或阿冠的交易開始的先後順序，只要在腦袋的交易先進行資料的更新，阿冠的交易在進行更新時都會拿到一樣的資料。</p>
<p>但如果是相同的高併發情境下使用悲觀鎖設計，交易開始的先後順序對相同一筆資料的讀取以及更新就會是不一樣的值。<br>並且悲觀鎖可以解決樂觀鎖設計造成高併發情況下資料不符合預期的情況。</p>
<p>為什麼呢?<br>別急，下一篇就來講悲觀鎖是甚麼東西~</p>
<p>總結一下樂觀鎖的優缺點<br>優點:<br>樂觀鎖因為是使用Version來做驗證，而不是對在整個交易的時候使用獨佔鎖等來確保資料的一致性。因此相較於在整個交易過程使用獨佔鎖的交易，可以使資料庫有較好的吞吐量。</p>
<p>缺點:<br>雖然使用Version來解決了高併發下的超賣問題，但是資料變化卻跟預期不符合。</p>
<p>心得:<br>幹累死。<br><img src="https://i.imgur.com/RmOhIzD.png" alt="Image"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://winstont77.github.io/2024/05/11/feat-concurency/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Winston Hsu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hanna & Ruby & Bru鼠 可愛動物區">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/05/11/feat-concurency/" class="post-title-link" itemprop="url">資料庫設計與併發問題 - 併發情況下使用預設隔離層級欄位的交易</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-11 19:29:05" itemprop="dateCreated datePublished" datetime="2024-05-11T19:29:05+08:00">2024-05-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-05-13 16:53:31" itemprop="dateModified" datetime="2024-05-13T16:53:31+08:00">2024-05-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>前言.<br>打算將下面兩個主題分開來闡述:<br>併發情況下使用預設隔離層級欄位的交易<br>如何防止庫存超扣-樂觀鎖<br>先打下來免得之後忘掉…</p>
<p>併發情況下使用預設隔離層級欄位的交易.<br>先使用SQL建立商品Id及庫存數量</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dbo.Product(</span><br><span class="line">	ProductID <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,            <span class="comment">/*商品Id*/</span></span><br><span class="line">	Quantity <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>              <span class="comment">/*庫存數量*/</span></span><br><span class="line">	<span class="keyword">PRIMARY</span> KEY (</span><br><span class="line">		ProductID</span><br><span class="line">	)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dbo.Product <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<p>接著會使用測試工具進行高併發情的模擬，我用的是SQLQueryStress。<br>並且在測試工具的參數中給定<br>Number of Iterations:50<br>Number of Threads:100<br>如下:<br><img src="https://i.imgur.com/kYjFowv.png" alt="Image"></p>
<p>並且在測試工具中使用以下腳本</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span> TRAN</span><br><span class="line">    <span class="comment">/* 訂單選擇的商品、以及訂購的數量 */</span></span><br><span class="line">	<span class="keyword">DECLARE</span> <span class="variable">@ProductID</span> <span class="type">INT</span> <span class="operator">=</span> <span class="number">1</span>,</span><br><span class="line">			<span class="variable">@Quantity</span> <span class="type">INT</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    <span class="comment">/* 判斷是否有此商品Id以及足夠庫存 */</span></span><br><span class="line">	IF <span class="keyword">EXISTS</span>(</span><br><span class="line">		<span class="keyword">SELECT</span> <span class="number">1</span></span><br><span class="line">		<span class="keyword">FROM</span> dbo.Product</span><br><span class="line">		<span class="keyword">WHERE</span> ProductID <span class="operator">=</span> <span class="variable">@ProductID</span></span><br><span class="line">			  <span class="keyword">AND</span> Quantity <span class="operator">&gt;=</span> <span class="variable">@Quantity</span> </span><br><span class="line">	)</span><br><span class="line">    <span class="comment">/* 有此商品以及足夠庫存，則對資料庫內該商品的庫存進行扣減 */</span></span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line">		<span class="keyword">UPDATE</span> dbo.Product</span><br><span class="line">		<span class="keyword">SET</span> Quantity <span class="operator">=</span> Quantity <span class="operator">-</span> <span class="variable">@Quantity</span></span><br><span class="line">		<span class="keyword">WHERE</span> ProductID <span class="operator">=</span> <span class="variable">@ProductID</span></span><br><span class="line">	<span class="keyword">END</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMIT</span> TRAN</span><br></pre></td></tr></table></figure>

<p>接著按下Go<br>跑完後去看資料庫內的庫存<br>執行該語法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br></pre></td></tr></table></figure>

<p><img src="https://i.imgur.com/ZwfJWjP.png" alt="Image"></p>
<p>哪尼!!!怎麼會這樣，不是有用IF做判斷了嗎。<br>為什麼還會出現庫存被扣到是負的狀況。</p>
<p>可以參考這個圖例<br><img src="https://i.imgur.com/IGJRt3S.png" alt="Image"><br>每一次的SQL指令要用到的資料都是當下從資料庫取得，因此阿冠在IF條件時的查詢，雖然是True，但是阿冠的交易進行到一半的時候，資料庫的庫存資料遭到Allen(腦袋)修改，當阿冠要修改庫存的時候，這時候庫存已經為0了，阿冠又繼續執行了更改庫存的交易，因此庫存被扣到負的。</p>
<p>為什麼會產生這個現象?<br>因為SQL Server的預設隔離層級為READ COMMITTED<br>READ COMMITTED又是啥?</p>
<p>Read Committed: 代表 transaction 只能讀到別的 transaction 已經 commit 的資料，沒有 commit 的話就不會讀到。包含了Non-repeatable reads和Phantom reads這兩種類型的表現。</p>
<p>所以以剛剛的例子來解釋就是阿冠的交易讀到了Allen已經COMMITTED的交易，並且是屬於Non-repeatable reads的行為，是Read Committed這個隔離層級在併發情況下允許的行為模式。</p>
<p>如果不知道Non-repeatable reads和Phantom reads是啥，這邊補充一下<br>Non-repeatable reads:<br><img src="https://i.imgur.com/DIVNxYl.png" alt="Image"></p>
<p>Phantom reads:<br><img src="https://i.imgur.com/KFBwH65.png" alt="Image"></p>
<p>下一篇會講要如何解決超賣問題喔!<br>敬請期待XD~</p>
<p>心得:<br>這個文章的門檻好高，資料庫的操作資料的方式就把我搞得暈頭轉向的。一開始我以為每個交易在下SQL指令的時候會先將資料庫的資料拿出來使用，所以一直無法理解為什麼阿冠的交易明明就已經拿到通過IF條件的庫存，為什麼還是會超賣。但之後才想到每個指令都是在資料庫Server裡操作資料。後來又想起了隔離層級這個課題，研究了一下隔離層級包含的三種行為後，以及SQL指令會直接在資料庫Server裡操作資料，兩個概念搭配後才理解這個案例到底發生了甚麼事。</p>
<p>感謝腦袋兄病危(其實只是感冒)之時還不忘認真閱讀我的文章，讓我能對這個高併發這個主題有更清楚的認識，希望腦袋兄可以早日康復。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://winstont77.github.io/2024/05/09/k6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Winston Hsu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hanna & Ruby & Bru鼠 可愛動物區">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/05/09/k6/" class="post-title-link" itemprop="url">樂觀鎖應用在高併發場景、學習如何使用K6模擬高併發場景</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-09 15:26:26" itemprop="dateCreated datePublished" datetime="2024-05-09T15:26:26+08:00">2024-05-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-05-10 17:54:31" itemprop="dateModified" datetime="2024-05-10T17:54:31+08:00">2024-05-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>今天也是彌補遺憾系列:<br>在AppWorkSchool的時候想要使用工具進行高併發情境模擬，但礙於資質拙劣來不及在專案時限內進行。</p>
<p>首先介紹一下樂觀鎖是甚麼</p>
<p>樂觀並行控制Optimistic Concurrency Control(OOC)，也稱作樂觀鎖Optimistic Locking。我們會在 table 欄位上添加 version 欄位來進行更新的確認，在更新資料前我們會撈取該筆資料的 version 並且在更新時，利用這個 version 與 table 內目前的 version 進行比對，若相同則代表這段時間沒有人修改資料，可進行更新動作；反之代表有人比你早一步更新。</p>
<p>我用樂觀鎖設計的欄位來做示範<br><img src="https://i.imgur.com/Eg2MsII.png" alt="Image"></p>
<p>整個測試架構大致如下<br><img src="https://i.imgur.com/s6PMDUz.png" alt="Image"><br>用K6寫測試腳本對電商系統發出請求，模擬使用者下單。整個訂購會發出兩個API，首先會先發出查詢商品狀態的API，接著再用取得的商品資訊帶入第二個API完成真正的下單。</p>
<p>以下為相關API的業務邏輯</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//購買商品:改變庫存數量、改變版本號(樂觀鎖)</span></span><br><span class="line">[<span class="meta">HttpGet</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;List&lt;Product&gt;&gt; Buy(<span class="built_in">int</span> productId, <span class="built_in">int</span> version)</span><br><span class="line">&#123;</span><br><span class="line">    Product product = <span class="keyword">await</span> _context.Product.Where(p =&gt; p.ProductId == productId).FirstAsync();</span><br><span class="line">    <span class="keyword">if</span> (version == product.Version&amp;&amp;product.Quantity &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        product.Version++;</span><br><span class="line">        product.Quantity--;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> _context.SaveChangesAsync();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> _context.Product.ToListAsync();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//獲得商品資訊:商品Id、庫存數量、版本(樂觀鎖)</span></span><br><span class="line">[<span class="meta">HttpGet(<span class="string">&quot;GetList&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;List&lt;Product&gt;&gt; GetList(<span class="built_in">int</span> productId)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> _context.Product.Where(p =&gt; p.ProductId == productId).ToListAsync();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以下為這次K6的測試腳本</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">&#x27;k6/http&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; check, sleep &#125; <span class="keyword">from</span> <span class="string">&#x27;k6&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> options = &#123;</span><br><span class="line">    <span class="attr">vus</span>: <span class="number">1</span>,  <span class="comment">// 設定 1 個虛擬用戶</span></span><br><span class="line">    <span class="attr">iterations</span>: <span class="number">10</span>,  <span class="comment">// 設定迭代次數為 10 次，也就是1個人加起來10次</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> version = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//該API會將商品資料拿回來</span></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> http.<span class="title function_">asyncRequest</span>(<span class="string">&#x27;GET&#x27;</span> ,<span class="string">&#x27;https://localhost:7120/api/BuyProduct/GetList?productId=1&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">headers</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">insecureSkipTLSVerify</span>: <span class="literal">true</span></span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">r</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;res:&#x27;</span>, r.<span class="title function_">json</span>()[<span class="number">0</span>]);    </span><br><span class="line">        version = r.<span class="title function_">json</span>()[<span class="number">0</span>].<span class="property">version</span>;         <span class="comment">//拿到該商品的version</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//該API會將version帶給後端，目的是用來作為樂觀鎖的判斷。</span></span><br><span class="line">    <span class="comment">//如果拿到的version比資料庫舊，交易就不會成立，而version也不會增加</span></span><br><span class="line">    <span class="comment">//如果是和資料庫的相同，交易則會成立並且version會增加</span></span><br><span class="line">    <span class="keyword">let</span> res2 = <span class="keyword">await</span> http.<span class="title function_">asyncRequest</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">`https://localhost:7120/api/BuyProduct?productId=1&amp;version=<span class="subst">$&#123;version&#125;</span>`</span>, &#123;</span><br><span class="line">        <span class="attr">headers</span>: &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span> &#125;,</span><br><span class="line">        <span class="attr">insecureSkipTLSVerify</span>: <span class="literal">true</span></span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">r</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;res2:&#x27;</span>, r.<span class="title function_">json</span>()[<span class="number">0</span>]);  <span class="comment">// 顯示商品資料</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接著在該K6腳本位置的terminal的部分輸入下列指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">K6 run &#123;your script&#125;.js</span><br></pre></td></tr></table></figure>

<p>我們可以看到terminal會出下列列輸出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:100,&quot;version&quot;:1&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:99,&quot;version&quot;:2&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;quantity&quot;:99,&quot;version&quot;:2,&quot;productId&quot;:1&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:98,&quot;version&quot;:3&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;version&quot;:3,&quot;productId&quot;:1,&quot;quantity&quot;:98&#125;  source=console                                                   </span><br><span class="line">INFO[0002] res2: &#123;&quot;quantity&quot;:97,&quot;version&quot;:4,&quot;productId&quot;:1&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:97,&quot;version&quot;:4&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:96,&quot;version&quot;:5&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;version&quot;:5,&quot;productId&quot;:1,&quot;quantity&quot;:96&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;version&quot;:6,&quot;productId&quot;:1,&quot;quantity&quot;:95&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:95,&quot;version&quot;:6&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:94,&quot;version&quot;:7&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:94,&quot;version&quot;:7&#125;  source=console</span><br><span class="line">INFO[0003] res2: &#123;&quot;quantity&quot;:93,&quot;version&quot;:8,&quot;productId&quot;:1&#125;  source=console</span><br><span class="line">INFO[0003] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:93,&quot;version&quot;:8&#125;  source=console</span><br><span class="line">INFO[0003] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:92,&quot;version&quot;:9&#125;  source=console</span><br><span class="line">INFO[0003] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:92,&quot;version&quot;:9&#125;  source=console</span><br><span class="line">INFO[0003] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:91,&quot;version&quot;:10&#125;  source=console</span><br><span class="line">INFO[0003] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:91,&quot;version&quot;:10&#125;  source=console</span><br><span class="line">INFO[0003] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:90,&quot;version&quot;:11&#125;  source=console</span><br></pre></td></tr></table></figure>
<p>可以看到這個結果如我寫的請求順序一樣井然有序，一個人下了十次訂單。因此庫存從100剩下90，版本也從1增加到11。</p>
<p>接著我們換成高併發的場景，將使用者增加到10個人，並且在短時間內發送共一百次的訂購</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">&#x27;k6/http&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; check, sleep &#125; <span class="keyword">from</span> <span class="string">&#x27;k6&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> options = &#123;</span><br><span class="line">    <span class="attr">vus</span>: <span class="number">10</span>,  <span class="comment">// 設定 10 個虛擬用戶</span></span><br><span class="line">    <span class="attr">iterations</span>: <span class="number">100</span>,  <span class="comment">// 設定迭代次數為 100 次，也就是10個人加起來100次</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> version = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//該API會將商品資料拿回來</span></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> http.<span class="title function_">asyncRequest</span>(<span class="string">&#x27;GET&#x27;</span> ,<span class="string">&#x27;https://localhost:7120/api/BuyProduct/GetList?productId=1&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">headers</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">insecureSkipTLSVerify</span>: <span class="literal">true</span></span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">r</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;res:&#x27;</span>, r.<span class="title function_">json</span>()[<span class="number">0</span>]);    </span><br><span class="line">        version = r.<span class="title function_">json</span>()[<span class="number">0</span>].<span class="property">version</span>;         <span class="comment">//拿到該商品的version</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//該API會將version帶給後端，目的是用來作為樂觀鎖的判斷。</span></span><br><span class="line">    <span class="comment">//如果拿到的version比資料庫舊，交易就不會成立，而version也不會增加</span></span><br><span class="line">    <span class="comment">//如果是和資料庫的相同，交易則會成立並且version會增加</span></span><br><span class="line">    <span class="keyword">let</span> res2 = <span class="keyword">await</span> http.<span class="title function_">asyncRequest</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">`https://localhost:7120/api/BuyProduct?productId=1&amp;version=<span class="subst">$&#123;version&#125;</span>`</span>, &#123;</span><br><span class="line">        <span class="attr">headers</span>: &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span> &#125;,</span><br><span class="line">        <span class="attr">insecureSkipTLSVerify</span>: <span class="literal">true</span></span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">r</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;res2:&#x27;</span>, r.<span class="title function_">json</span>()[<span class="number">0</span>]);  <span class="comment">// 顯示商品資料</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接著我們會看到如下輸出:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><span class="line">INFO[0000] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:90,&quot;version&quot;:11&#125;  source=console</span><br><span class="line">INFO[0000] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:90,&quot;version&quot;:11&#125;  source=console                                                  </span><br><span class="line">INFO[0000] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:90,&quot;version&quot;:11&#125;  source=console                                                  </span><br><span class="line">INFO[0000] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:90,&quot;version&quot;:11&#125;  source=console</span><br><span class="line">INFO[0000] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:90,&quot;version&quot;:11&#125;  source=console</span><br><span class="line">INFO[0000] res: &#123;&quot;version&quot;:11,&quot;productId&quot;:1,&quot;quantity&quot;:90&#125;  source=console</span><br><span class="line">INFO[0000] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:90,&quot;version&quot;:11&#125;  source=console</span><br><span class="line">INFO[0000] res: &#123;&quot;quantity&quot;:90,&quot;version&quot;:11,&quot;productId&quot;:1&#125;  source=console                                                  </span><br><span class="line">INFO[0000] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:90,&quot;version&quot;:11&#125;  source=console                                                  </span><br><span class="line">INFO[0000] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:90,&quot;version&quot;:11&#125;  source=console                                                  </span><br><span class="line">INFO[0000] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:89,&quot;version&quot;:12&#125;  source=console</span><br><span class="line">INFO[0000] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:89,&quot;version&quot;:12&#125;  source=console</span><br><span class="line">INFO[0000] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:89,&quot;version&quot;:12&#125;  source=console</span><br><span class="line">INFO[0000] res2: &#123;&quot;quantity&quot;:89,&quot;version&quot;:12,&quot;productId&quot;:1&#125;  source=console</span><br><span class="line">INFO[0000] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:89,&quot;version&quot;:12&#125;  source=console</span><br><span class="line">INFO[0000] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:89,&quot;version&quot;:12&#125;  source=console                                                 </span><br><span class="line">INFO[0000] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:89,&quot;version&quot;:12&#125;  source=console                                                 </span><br><span class="line">INFO[0000] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:89,&quot;version&quot;:12&#125;  source=console</span><br><span class="line">INFO[0000] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:89,&quot;version&quot;:12&#125;  source=console</span><br><span class="line">INFO[0000] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:89,&quot;version&quot;:12&#125;  source=console                                                  </span><br><span class="line">INFO[0000] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:89,&quot;version&quot;:12&#125;  source=console                                                  </span><br><span class="line">INFO[0000] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:89,&quot;version&quot;:12&#125;  source=console</span><br><span class="line">INFO[0000] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:89,&quot;version&quot;:12&#125;  source=console</span><br><span class="line">INFO[0000] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:89,&quot;version&quot;:12&#125;  source=console</span><br><span class="line">INFO[0000] res: &#123;&quot;quantity&quot;:89,&quot;version&quot;:12,&quot;productId&quot;:1&#125;  source=console</span><br><span class="line">INFO[0000] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:89,&quot;version&quot;:12&#125;  source=console                                                  </span><br><span class="line">INFO[0000] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:89,&quot;version&quot;:12&#125;  source=console</span><br><span class="line">INFO[0000] res: &#123;&quot;quantity&quot;:89,&quot;version&quot;:12,&quot;productId&quot;:1&#125;  source=console</span><br><span class="line">INFO[0000] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:88,&quot;version&quot;:13&#125;  source=console                                                 </span><br><span class="line">INFO[0000] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:88,&quot;version&quot;:13&#125;  source=console                                                 </span><br><span class="line">INFO[0000] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:89,&quot;version&quot;:12&#125;  source=console                                                  </span><br><span class="line">INFO[0000] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:88,&quot;version&quot;:13&#125;  source=console</span><br><span class="line">INFO[0000] res2: &#123;&quot;version&quot;:13,&quot;productId&quot;:1,&quot;quantity&quot;:88&#125;  source=console                                                 </span><br><span class="line">INFO[0000] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:88,&quot;version&quot;:13&#125;  source=console                                                 </span><br><span class="line">INFO[0000] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:88,&quot;version&quot;:13&#125;  source=console</span><br><span class="line">INFO[0000] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:88,&quot;version&quot;:13&#125;  source=console                                                  </span><br><span class="line">INFO[0000] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:88,&quot;version&quot;:13&#125;  source=console                                                 </span><br><span class="line">INFO[0000] res2: &#123;&quot;version&quot;:13,&quot;productId&quot;:1,&quot;quantity&quot;:88&#125;  source=console</span><br><span class="line">INFO[0000] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:88,&quot;version&quot;:13&#125;  source=console                                                  </span><br><span class="line">INFO[0000] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:88,&quot;version&quot;:13&#125;  source=console</span><br><span class="line">INFO[0000] res2: &#123;&quot;quantity&quot;:88,&quot;version&quot;:13,&quot;productId&quot;:1&#125;  source=console                                                 </span><br><span class="line">INFO[0000] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:88,&quot;version&quot;:13&#125;  source=console</span><br><span class="line">INFO[0001] res: &#123;&quot;version&quot;:13,&quot;productId&quot;:1,&quot;quantity&quot;:88&#125;  source=console</span><br><span class="line">INFO[0001] res: &#123;&quot;version&quot;:13,&quot;productId&quot;:1,&quot;quantity&quot;:88&#125;  source=console                                                  </span><br><span class="line">INFO[0001] res2: &#123;&quot;quantity&quot;:87,&quot;version&quot;:14,&quot;productId&quot;:1&#125;  source=console</span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:88,&quot;version&quot;:13&#125;  source=console                                                  </span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:87,&quot;version&quot;:14&#125;  source=console</span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:87,&quot;version&quot;:14&#125;  source=console                                                  </span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:87,&quot;version&quot;:14&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:87,&quot;version&quot;:14&#125;  source=console</span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:87,&quot;version&quot;:14&#125;  source=console                                                  </span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:87,&quot;version&quot;:14&#125;  source=console</span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:87,&quot;version&quot;:14&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:87,&quot;version&quot;:14&#125;  source=console                                                  </span><br><span class="line">INFO[0001] res2: &#123;&quot;quantity&quot;:87,&quot;version&quot;:14,&quot;productId&quot;:1&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:86,&quot;version&quot;:15&#125;  source=console</span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:87,&quot;version&quot;:14&#125;  source=console                                                  </span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:87,&quot;version&quot;:14&#125;  source=console</span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:87,&quot;version&quot;:14&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:86,&quot;version&quot;:15&#125;  source=console</span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:86,&quot;version&quot;:15&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:86,&quot;version&quot;:15&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res: &#123;&quot;quantity&quot;:86,&quot;version&quot;:15,&quot;productId&quot;:1&#125;  source=console                                                  </span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:86,&quot;version&quot;:15&#125;  source=console</span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:86,&quot;version&quot;:15&#125;  source=console                                                  </span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:86,&quot;version&quot;:15&#125;  source=console</span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:86,&quot;version&quot;:15&#125;  source=console</span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:86,&quot;version&quot;:15&#125;  source=console</span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:85,&quot;version&quot;:16&#125;  source=console</span><br><span class="line">INFO[0001] res: &#123;&quot;version&quot;:15,&quot;productId&quot;:1,&quot;quantity&quot;:86&#125;  source=console                                                  </span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:86,&quot;version&quot;:15&#125;  source=console                                                  </span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:85,&quot;version&quot;:16&#125;  source=console                                                  </span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:85,&quot;version&quot;:16&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:85,&quot;version&quot;:16&#125;  source=console</span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:86,&quot;version&quot;:15&#125;  source=console                                                  </span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:85,&quot;version&quot;:16&#125;  source=console                                                  </span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:85,&quot;version&quot;:16&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:85,&quot;version&quot;:16&#125;  source=console</span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:85,&quot;version&quot;:16&#125;  source=console</span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:85,&quot;version&quot;:16&#125;  source=console</span><br><span class="line">INFO[0001] res: &#123;&quot;quantity&quot;:85,&quot;version&quot;:16,&quot;productId&quot;:1&#125;  source=console</span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:85,&quot;version&quot;:16&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:85,&quot;version&quot;:16&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:85,&quot;version&quot;:16&#125;  source=console</span><br><span class="line">INFO[0001] res2: &#123;&quot;version&quot;:17,&quot;productId&quot;:1,&quot;quantity&quot;:84&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:84,&quot;version&quot;:17&#125;  source=console</span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:84,&quot;version&quot;:17&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:84,&quot;version&quot;:17&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:84,&quot;version&quot;:17&#125;  source=console</span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:84,&quot;version&quot;:17&#125;  source=console                                                  </span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:84,&quot;version&quot;:17&#125;  source=console                                                  </span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:84,&quot;version&quot;:17&#125;  source=console                                                  </span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:84,&quot;version&quot;:17&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:84,&quot;version&quot;:17&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:84,&quot;version&quot;:17&#125;  source=console</span><br><span class="line">INFO[0001] res2: &#123;&quot;version&quot;:17,&quot;productId&quot;:1,&quot;quantity&quot;:84&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res: &#123;&quot;quantity&quot;:84,&quot;version&quot;:17,&quot;productId&quot;:1&#125;  source=console                                                  </span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:83,&quot;version&quot;:18&#125;  source=console</span><br><span class="line">INFO[0001] res2: &#123;&quot;version&quot;:18,&quot;productId&quot;:1,&quot;quantity&quot;:83&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res2: &#123;&quot;version&quot;:18,&quot;productId&quot;:1,&quot;quantity&quot;:83&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:83,&quot;version&quot;:18&#125;  source=console</span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:83,&quot;version&quot;:18&#125;  source=console</span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:83,&quot;version&quot;:18&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:83,&quot;version&quot;:18&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:82,&quot;version&quot;:19&#125;  source=console</span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:83,&quot;version&quot;:18&#125;  source=console</span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:83,&quot;version&quot;:18&#125;  source=console</span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:83,&quot;version&quot;:18&#125;  source=console                                                  </span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:83,&quot;version&quot;:18&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res: &#123;&quot;version&quot;:19,&quot;productId&quot;:1,&quot;quantity&quot;:82&#125;  source=console</span><br><span class="line">INFO[0001] res2: &#123;&quot;version&quot;:19,&quot;productId&quot;:1,&quot;quantity&quot;:82&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:83,&quot;version&quot;:18&#125;  source=console</span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:82,&quot;version&quot;:19&#125;  source=console                                                  </span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:82,&quot;version&quot;:19&#125;  source=console                                                  </span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:82,&quot;version&quot;:19&#125;  source=console</span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:82,&quot;version&quot;:19&#125;  source=console</span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:82,&quot;version&quot;:19&#125;  source=console                                                  </span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:82,&quot;version&quot;:19&#125;  source=console                                                 </span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:82,&quot;version&quot;:19&#125;  source=console</span><br><span class="line">INFO[0001] res2: &#123;&quot;version&quot;:20,&quot;productId&quot;:1,&quot;quantity&quot;:81&#125;  source=console</span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:81,&quot;version&quot;:20&#125;  source=console</span><br><span class="line">INFO[0001] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:82,&quot;version&quot;:19&#125;  source=console</span><br><span class="line">INFO[0001] res2: &#123;&quot;version&quot;:19,&quot;productId&quot;:1,&quot;quantity&quot;:82&#125;  source=console</span><br><span class="line">INFO[0001] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:81,&quot;version&quot;:20&#125;  source=console                                                 </span><br><span class="line">INFO[0002] res2: &#123;&quot;version&quot;:20,&quot;productId&quot;:1,&quot;quantity&quot;:81&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;quantity&quot;:81,&quot;version&quot;:20,&quot;productId&quot;:1&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;quantity&quot;:81,&quot;version&quot;:20,&quot;productId&quot;:1&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:81,&quot;version&quot;:20&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:81,&quot;version&quot;:20&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:81,&quot;version&quot;:20&#125;  source=console                                                  </span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:81,&quot;version&quot;:20&#125;  source=console                                                  </span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:81,&quot;version&quot;:20&#125;  source=console                                                  </span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:81,&quot;version&quot;:20&#125;  source=console                                                 </span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:81,&quot;version&quot;:20&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:81,&quot;version&quot;:20&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:81,&quot;version&quot;:20&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:81,&quot;version&quot;:20&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:80,&quot;version&quot;:21&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;quantity&quot;:80,&quot;version&quot;:21,&quot;productId&quot;:1&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:81,&quot;version&quot;:20&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:80,&quot;version&quot;:21&#125;  source=console                                                 </span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:80,&quot;version&quot;:21&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;quantity&quot;:80,&quot;version&quot;:21,&quot;productId&quot;:1&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:80,&quot;version&quot;:21&#125;  source=console                                                 </span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:80,&quot;version&quot;:21&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;quantity&quot;:80,&quot;version&quot;:21,&quot;productId&quot;:1&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;version&quot;:21,&quot;productId&quot;:1,&quot;quantity&quot;:80&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:80,&quot;version&quot;:21&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;version&quot;:21,&quot;productId&quot;:1,&quot;quantity&quot;:80&#125;  source=console                                                  </span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:80,&quot;version&quot;:21&#125;  source=console                                                  </span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:80,&quot;version&quot;:21&#125;  source=console                                                  </span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:80,&quot;version&quot;:21&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;quantity&quot;:80,&quot;version&quot;:21,&quot;productId&quot;:1&#125;  source=console                                                  </span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:80,&quot;version&quot;:21&#125;  source=console                                                 </span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:80,&quot;version&quot;:21&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:80,&quot;version&quot;:21&#125;  source=console                                                  </span><br><span class="line">INFO[0002] res: &#123;&quot;version&quot;:21,&quot;productId&quot;:1,&quot;quantity&quot;:80&#125;  source=console                                                  </span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:79,&quot;version&quot;:22&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:79,&quot;version&quot;:22&#125;  source=console                                                 </span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:79,&quot;version&quot;:22&#125;  source=console                                                 </span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:80,&quot;version&quot;:21&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:79,&quot;version&quot;:22&#125;  source=console                                                 </span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:79,&quot;version&quot;:22&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:79,&quot;version&quot;:22&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:79,&quot;version&quot;:22&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:79,&quot;version&quot;:22&#125;  source=console                                                 </span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:79,&quot;version&quot;:22&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:79,&quot;version&quot;:22&#125;  source=console                                                  </span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:79,&quot;version&quot;:22&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;version&quot;:22,&quot;productId&quot;:1,&quot;quantity&quot;:79&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:79,&quot;version&quot;:22&#125;  source=console                                                  </span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:79,&quot;version&quot;:22&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:79,&quot;version&quot;:22&#125;  source=console                                                 </span><br><span class="line">INFO[0002] res: &#123;&quot;quantity&quot;:79,&quot;version&quot;:22,&quot;productId&quot;:1&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:79,&quot;version&quot;:22&#125;  source=console                                                  </span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:79,&quot;version&quot;:22&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:79,&quot;version&quot;:22&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:78,&quot;version&quot;:23&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;quantity&quot;:78,&quot;version&quot;:23,&quot;productId&quot;:1&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:78,&quot;version&quot;:23&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:78,&quot;version&quot;:23&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:78,&quot;version&quot;:23&#125;  source=console                                                 </span><br><span class="line">INFO[0002] res2: &#123;&quot;version&quot;:23,&quot;productId&quot;:1,&quot;quantity&quot;:78&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:78,&quot;version&quot;:23&#125;  source=console                                                 </span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:78,&quot;version&quot;:23&#125;  source=console                                                 </span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:78,&quot;version&quot;:23&#125;  source=console                                                 </span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:78,&quot;version&quot;:23&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:78,&quot;version&quot;:23&#125;  source=console</span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:78,&quot;version&quot;:23&#125;  source=console                                                  </span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:78,&quot;version&quot;:23&#125;  source=console                                                  </span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:78,&quot;version&quot;:23&#125;  source=console                                                  </span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:78,&quot;version&quot;:23&#125;  source=console                                                  </span><br><span class="line">INFO[0002] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:78,&quot;version&quot;:23&#125;  source=console                                                  </span><br><span class="line">INFO[0002] res2: &#123;&quot;version&quot;:24,&quot;productId&quot;:1,&quot;quantity&quot;:77&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:77,&quot;version&quot;:24&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;quantity&quot;:77,&quot;version&quot;:24,&quot;productId&quot;:1&#125;  source=console</span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:77,&quot;version&quot;:24&#125;  source=console                                                 </span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:77,&quot;version&quot;:24&#125;  source=console                                                 </span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:77,&quot;version&quot;:24&#125;  source=console                                                 </span><br><span class="line">INFO[0002] res2: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:77,&quot;version&quot;:24&#125;  source=console </span><br></pre></td></tr></table></figure>
<p>可以發現增加使用者人數增加後，會有多人同時操作同筆資料的情況出現<br>大家同時在version&#x3D;11的時候，發出了查詢商品資訊的請求，因此這個訊息被印出了好幾次</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INFO[0000] res: &#123;&quot;productId&quot;:1,&quot;quantity&quot;:90,&quot;version&quot;:11&#125;  source=console</span><br></pre></td></tr></table></figure>
<p>接著這些使用者又將相同的version，帶入購買的請求，因此大家也都在購買請求的回應看到相同的商品資訊</p>
<p>INFO[0000] res2: {“productId”:1,”quantity”:89,”version”:12}  source&#x3D;console</p>
<p>本來10個人第一次購買的時候應該要看到顯示商品資訊內的庫存會隨著API回應的顯示的順序而遞減，version則會隨著遞增。所以每個人都應該要看到不同的資訊除了productId以外，結果大家都看到相同的資訊，也就是說已經有十個人成功下單，資料庫應該要扣10單位的庫存，結果是顯示扣1。在併發的時候結果樂觀鎖不符合預期，會造成嚴重的超賣現象。</p>
<p>樂觀鎖 — Optimistic Lock<br>優點：因為沒有在資料庫加鎖，所以 SQL command 都會購對 data 進行操作，只有在更新 data 時才會做驗證；這樣就避免悲觀鎖導致的吞吐量下降的問題</p>
<p>缺點：資料變化不符合預期，在高併發設計不適合使用。</p>
<p>WTF，悲觀鎖又是啥?下一篇告訴你。</p>
<p>心得:<br>在去年的時候還不知道要怎麼定義高併發情境，以至於不知道要怎麼使用工具模擬高併發，不知道要如何預期高併發造成的結果，像是剛剛提到的超賣現象，會有數名使用者得到相同商品資訊的情況。資料庫端也不懂得如何設計應對併發的設計。</p>
<p>現在終於有能力觸及這門學問，雖然只是研究高併發情境的第一步，但是卻覺得終於放下心中的一塊大石。</p>
<p>想想去年還在AppWorkSchool耍白癡，不知道大家現在過得好不好，好感慨阿~<br><img src="https://i.imgur.com/zBevTSS.png" alt="Image"><br><img src="https://i.imgur.com/7j9t1Vm.png" alt="Image"></p>
<p><img src="https://i.imgur.com/E0ES08a.png" alt="Image"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://winstont77.github.io/2024/05/04/optimistic-concurrency-control/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Winston Hsu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hanna & Ruby & Bru鼠 可愛動物區">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/05/04/optimistic-concurrency-control/" class="post-title-link" itemprop="url">併發解決方案 - 樂觀鎖</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-04 14:15:11" itemprop="dateCreated datePublished" datetime="2024-05-04T14:15:11+08:00">2024-05-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-05-08 21:29:09" itemprop="dateModified" datetime="2024-05-08T21:29:09+08:00">2024-05-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>研究目的:<br>剛接觸後端的時候就對大流量以及高併發的設計很有興趣，但礙於當初製作個人專案時間有限以及相關知識涉略不足，因此沒能系統性的去理解這門學問。</p>
<p>最近有時間重新研究這個課題，之前專案想做的主題和購物網站的秒殺活動或是熱門演唱會的售票網站方向大致向同。都是想研究一個網頁應用在大流量以及高併發下藥怎麼設計。</p>
<p>甚麼是大流量問題:<br>每個server有處理請求的極限，如果今天某電商網站的server只有一台，並且這台server的請求處理極限是每秒鐘100筆。如果有超過一百個使用者同時在操作，那就會突破這台server的承受能力，這時就會遭遇大流量問題。因此是個相對問題。</p>
<p>甚麼是高併發:<br>假如server在能夠承受請求的情況下，發生變數競爭的問題。同樣以購物網站作為例子，假如今天有手機特賣活動，剩一支手機的時候，但同時有使用者A以及使用者B皆成功下定。</p>
<p>要怎麼解決大流量:<br>通常是從以系統層面來考量，方式有前端以及後端各自的解決方案，</p>
<p>前端的的話會使用負載平衡，像是AWS的<br>Elastic Load Balancing、google的Cloud Load Balancing以及microsoft的Azure Load Balancer。</p>
<p>後端有水平擴展以及垂直擴展兩種類型。</p>
<p>水平擴展:<br>將系統的數量增加。像是資料庫的讀寫分離系統(CQRS)。</p>
<p>垂直擴展:<br>升級系統的硬體條件。例如替換記憶體或是CPU等。</p>
<p>剛寫程式怎麼可能會知道CQRS是甚麼東東，甚至是CQRS使用到的工具以及程式設計方式，因此後續會再寫文章專門對CQRS介紹。</p>
<p>接著再繼續介紹系統是如何解決高併發的問題:<br>併發問題要在程式面討論，承接一開始的電商舉辦秒殺活動的舉例，<br>A使用者和B使用者對僅剩一個的商品進行下單，並且也都下單成功。</p>
<p>建立一個資料表Product並建立一個PK在ProductID欄位上，裡面Patch一筆資料ProductId &#x3D; 1剩餘數量有1個</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE dbo.Product(</span><br><span class="line">	ProductID INT NOT NULL,</span><br><span class="line">	Quantity DECIMAL NOT NULL</span><br><span class="line">	PRIMARY KEY (</span><br><span class="line">		ProductID</span><br><span class="line">	)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO dbo.Product VALUES (1,1);</span><br></pre></td></tr></table></figure>


<p>下面這段為執行產品數量扣除的腳本:<br>當ProductID是1的產品的剩餘數量大於@Quantity時，執行扣除。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">BEGIN TRAN</span><br><span class="line">	DECLARE @ProductID INT = 1,</span><br><span class="line">			@Quantity DECIMAL(18,4) = 1</span><br><span class="line"></span><br><span class="line">	IF EXISTS(</span><br><span class="line">		SELECT 1</span><br><span class="line">		FROM dbo.Product</span><br><span class="line">		WHERE ProductID = @ProductID</span><br><span class="line">			  AND Quantity &gt;= @Quantity </span><br><span class="line">	)</span><br><span class="line">	BEGIN</span><br><span class="line">		UPDATE dbo.Product</span><br><span class="line">		SET Quantity = Quantity - @Quantity</span><br><span class="line">		WHERE ProductID = @ProductID</span><br><span class="line">	END</span><br><span class="line"></span><br><span class="line">COMMIT TRAN</span><br></pre></td></tr></table></figure>

<p>但是模擬併發情況時，卻會看到Quantity是負的情況。<br>遇到這種情況有很多解決方式，今天介紹比較其中一種。使用樂觀鎖是一種比較容易的解決方式，因為目前的問題也沒有要用到複雜的條件。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://winstont77.github.io/2024/05/03/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Winston Hsu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hanna & Ruby & Bru鼠 可愛動物區">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/05/03/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-03 16:58:01" itemprop="dateCreated datePublished" datetime="2024-05-03T16:58:01+08:00">2024-05-03</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Winston Hsu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Winston Hsu</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  <script src="https://winstont77.github.io/oneko/oneko.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false});</script></body>
</html>
